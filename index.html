<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ğŸ€„ 2026 éº»å°‡å¤§æ•¸æ“šçµ±è¨ˆè¡¨</title>
    
    <!-- PWA èˆ‡ å…¨ç•«é¢è¨­å®š -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="éº»å°‡å¤§æ•¸æ“š">
    <link rel="apple-touch-icon" href="https://img.icons8.com/color/512/mahjong-win.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fff5f7;
            color: #5d4037;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            /* é‡å°å…¨ç•«é¢é¿é–‹ç€æµ·å€ */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }

        .cute-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(255, 182, 193, 0.1);
            border: 1px solid #ffcad4;
        }

        .btn-cute {
            background: #ffb7b2;
            color: white;
            padding: 6px 12px;
            border-radius: 999px;
            transition: all 0.3s;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 6px;
            transition: 0.2s;
            font-size: 0.75rem;
            position: relative;
        }

        .calendar-day.selected {
            background: #ff758f;
            color: white;
            font-weight: bold;
        }

        .calendar-day.has-data::after {
            content: '';
            position: absolute;
            bottom: 2px;
            width: 3px;
            height: 3px;
            background-color: #ff758f;
            border-radius: 50%;
        }

        input, select {
            border: 1px solid #f8edeb;
            border-radius: 6px;
            padding: 4px 6px;
            outline: none;
            width: 100%;
            font-size: 13px;
            -webkit-appearance: none;
        }

        .table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        @media (max-width: 640px) {
            .mobile-p { padding: 0.5rem !important; }
            h1 { font-size: 1.25rem !important; margin-bottom: 0.5rem !important; }
            .grid-cols-12 { display: block !important; }
            .cute-card { margin-bottom: 0.75rem; }
            .cute-card:last-child { margin-bottom: 0; }
        }
    </style>
</head>
<body class="p-2 pb-0 md:p-6">

    <div class="max-w-4xl mx-auto mobile-p">
        <!-- Header -->
        <header class="text-center mb-2">
            <h1 class="text-xl md:text-3xl font-bold text-[#ff758f]">ğŸ€„ 2026 éº»å°‡å¤§æ•¸æ“š</h1>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
            
            <!-- Left: Calendar & Stats -->
            <div class="lg:col-span-4 space-y-4">
                <div class="cute-card p-3">
                    <div class="flex justify-between items-center mb-2">
                        <button onclick="changeMonth(-1)" class="text-[#ff758f] font-bold px-2">â®</button>
                        <h2 id="currentMonthDisplay" class="text-xs font-bold text-gray-600">2026å¹´ 1æœˆ</h2>
                        <button onclick="changeMonth(1)" class="text-[#ff758f] font-bold px-2">â¯</button>
                    </div>
                    <div class="grid grid-cols-7 gap-1 text-center text-[10px] mb-1 font-bold text-gray-400">
                        <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>
                    </div>
                    <div id="calendarGrid" class="grid grid-cols-7 gap-1"></div>
                </div>

                <div class="cute-card p-3 bg-[#fff0f3]">
                    <h3 class="text-[10px] font-bold mb-2 flex items-center text-gray-500 uppercase tracking-wider">
                        ğŸ† ç´¯è¨ˆæ’å
                    </h3>
                    <div id="overallStatsList" class="space-y-1">
                        <p class="text-[10px] text-gray-400 text-center">å°šç„¡ç´€éŒ„</p>
                    </div>
                </div>
            </div>

            <!-- Right: Daily Form -->
            <div class="lg:col-span-8">
                <div class="cute-card p-3 md:p-5">
                    <div class="flex justify-between items-center mb-3 border-b pb-2 border-pink-50">
                        <h2 class="text-base font-bold text-[#ff758f]">
                            ğŸ“… <span id="selectedDateDisplay">2026-01-01</span>
                        </h2>
                        <span id="balanceBadge" class="px-2 py-0.5 rounded-full text-[9px] bg-gray-100 text-gray-500">
                            æœªè¼¸å…¥
                        </span>
                    </div>

                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <div class="flex flex-col">
                            <label class="text-[9px] font-bold mb-0.5 text-gray-400">åº•/å°</label>
                            <select id="gameType">
                                <option value="30/10">30/10</option>
                                <option value="50/20">50/20</option>
                                <option value="100/20">100/20</option>
                            </select>
                        </div>
                        <div class="flex flex-col">
                            <label class="text-[9px] font-bold mb-0.5 text-gray-400">åœ°é»</label>
                            <input type="text" id="location" placeholder="åœ°é»">
                        </div>
                        <div class="flex flex-col">
                            <label class="text-[9px] font-bold mb-0.5 text-gray-400">å°‡æ•¸</label>
                            <input type="number" id="rounds" value="1">
                        </div>
                    </div>

                    <div class="table-container mb-4">
                        <table class="w-full text-left min-w-full">
                            <thead>
                                <tr class="text-[9px] border-b border-pink-50 text-gray-400">
                                    <th class="py-1">éº»å‹</th>
                                    <th class="py-1">è´(+)</th>
                                    <th class="py-1">è¼¸(-)</th>
                                    <th class="py-1 text-right">å°è¨ˆ</th>
                                </tr>
                            </thead>
                            <tbody id="playerTableBody">
                            </tbody>
                        </table>
                    </div>

                    <div class="flex flex-col gap-2">
                        <div class="text-[9px] text-gray-400 italic text-center" id="errorMsg">
                            * ç¸½å’Œé ˆç‚º 0ã€‚
                        </div>
                        <div class="flex gap-2">
                            <button onclick="clearForm()" class="flex-1 py-1.5 rounded-full border border-pink-100 text-pink-300 font-bold text-[10px]">æ¸…ç©º</button>
                            <button id="saveBtn" onclick="saveData()" class="flex-1 btn-cute text-[10px]">å„²å­˜ğŸ’¾</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentYear = 2026;
        let currentMonth = 0;
        let selectedDate = "2026-01-01";
        // å›ºå®šéº»å‹åå–®
        const FIXED_PLAYERS = ["WKC", "Alex", "JayDeep", "Molly", "Yachin"];
        let mahjongData = JSON.parse(localStorage.getItem('mahjong_2026_data')) || {};

        function init() {
            renderPlayerRows();
            renderCalendar();
            selectDate(selectedDate);
            updateOverallStats();
            setupInputListeners();
        }

        function renderPlayerRows() {
            const tbody = document.getElementById('playerTableBody');
            tbody.innerHTML = '';
            
            // ç”Ÿæˆ 4 å€‹æ¬„ä½ï¼Œé è¨­å¸¶å…¥å‰ 4 ä½å›ºå®šçš„éº»å‹
            for (let i = 0; i < 4; i++) {
                const defaultPlayer = FIXED_PLAYERS[i] || "";
                
                // ç”¢ç”Ÿé¸å–®é¸é …
                const optionsHtml = FIXED_PLAYERS.map(name => 
                    `<option value="${name}" ${name === defaultPlayer ? 'selected' : ''}>${name}</option>`
                ).join('');

                tbody.innerHTML += `
                    <tr class="border-b border-pink-50">
                        <td class="py-2">
                            <select class="player-select w-20 sm:w-24">
                                ${optionsHtml}
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                        </td>
                        <td class="py-2"><input type="number" class="win-input w-12 sm:w-16" value="0"></td>
                        <td class="py-2"><input type="number" class="loss-input w-12 sm:w-16" value="0"></td>
                        <td class="py-2 text-right font-bold row-total text-[11px]">0</td>
                    </tr>
                `;
            }
        }

        function setupInputListeners() {
            document.querySelectorAll('.win-input, .loss-input').forEach(input => {
                input.addEventListener('input', calculateDailyTotal);
            });
            document.querySelectorAll('.player-select').forEach(select => {
                select.addEventListener('change', calculateDailyTotal);
            });
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const display = document.getElementById('currentMonthDisplay');
            grid.innerHTML = '';
            const date = new Date(currentYear, currentMonth, 1);
            display.innerText = `${currentYear}å¹´ ${currentMonth + 1}æœˆ`;
            const firstDay = date.getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) grid.innerHTML += `<div></div>`;
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const isSelected = dateStr === selectedDate;
                const hasData = mahjongData[dateStr] ? 'has-data' : '';
                const dayEl = document.createElement('div');
                dayEl.className = `calendar-day ${isSelected ? 'selected' : ''} ${hasData}`;
                dayEl.innerText = day;
                dayEl.onclick = () => selectDate(dateStr);
                grid.appendChild(dayEl);
            }
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth > 11) { currentMonth = 0; currentYear++; }
            if (currentMonth < 0) { currentMonth = 11; currentYear--; }
            renderCalendar();
        }

        function selectDate(dateStr) {
            selectedDate = dateStr;
            document.getElementById('selectedDateDisplay').innerText = dateStr;
            renderCalendar();
            
            const rows = document.querySelectorAll('#playerTableBody tr');
            if (mahjongData[dateStr]) {
                const data = mahjongData[dateStr];
                document.getElementById('gameType').value = data.type;
                document.getElementById('location').value = data.location;
                document.getElementById('rounds').value = data.rounds;
                data.players.forEach((p, i) => {
                    const select = rows[i].querySelector('.player-select');
                    const inputs = rows[i].querySelectorAll('input');
                    
                    // å¦‚æœå­˜çš„å€¼ä¸åœ¨é¸å–®å…§ï¼Œå¯ä»¥å‹•æ…‹åŠ ä¸Šæˆ–é¸å…¶ä»–
                    if (!FIXED_PLAYERS.includes(p.name)) {
                        const opt = document.createElement('option');
                        opt.value = p.name;
                        opt.text = p.name;
                        select.add(opt, select.options[0]);
                    }
                    select.value = p.name;
                    inputs[0].value = p.win;
                    inputs[1].value = p.loss;
                });
            } else {
                document.querySelectorAll('.win-input, .loss-input').forEach(i => i.value = 0);
                document.getElementById('location').value = '';
                document.getElementById('rounds').value = 1;
                // é‡ç½®ç©å®¶ç‚ºé è¨­é †åº
                rows.forEach((row, i) => {
                    row.querySelector('.player-select').value = FIXED_PLAYERS[i] || "å…¶ä»–";
                });
            }
            calculateDailyTotal();
        }

        function calculateDailyTotal() {
            const rows = document.querySelectorAll('#playerTableBody tr');
            let grandTotal = 0;
            rows.forEach(row => {
                const win = parseInt(row.querySelector('.win-input').value) || 0;
                const loss = parseInt(row.querySelector('.loss-input').value) || 0;
                const net = win - loss;
                row.querySelector('.row-total').innerText = net;
                row.querySelector('.row-total').className = `py-2 text-right font-bold row-total text-[11px] ${net > 0 ? 'text-green-500' : (net < 0 ? 'text-red-500' : 'text-gray-400')}`;
                grandTotal += net;
            });
            const badge = document.getElementById('balanceBadge');
            badge.innerText = grandTotal === 0 ? "ğŸ’° å¸³ç›®å¹³è¡¡" : `âš ï¸ å·®: ${grandTotal}`;
            badge.className = `px-2 py-0.5 rounded-full text-[9px] ${grandTotal === 0 ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}`;
        }

        function saveData() {
            const rows = document.querySelectorAll('#playerTableBody tr');
            let grandTotal = 0;
            const players = [];
            
            // æª¢æŸ¥æ˜¯å¦æœ‰é‡è¤‡é¸æ“‡ç©å®¶
            const selectedNames = [];
            let duplicate = false;

            rows.forEach(row => {
                const name = row.querySelector('.player-select').value;
                const win = parseInt(row.querySelector('.win-input').value) || 0;
                const loss = parseInt(row.querySelector('.loss-input').value) || 0;
                
                if (selectedNames.includes(name)) duplicate = true;
                selectedNames.push(name);
                
                players.push({ name, win, loss });
                grandTotal += (win - loss);
            });

            if (duplicate) { alert("ä¸å¯é¸æ“‡é‡è¤‡çš„ç©å®¶ï¼"); return; }
            if (grandTotal !== 0) { alert("å¸³ç›®ä¸å°å–”ï¼ç¸½å’Œé ˆç‚º 0ã€‚"); return; }
            
            mahjongData[selectedDate] = {
                type: document.getElementById('gameType').value,
                location: document.getElementById('location').value,
                rounds: document.getElementById('rounds').value,
                players: players
            };
            localStorage.setItem('mahjong_2026_data', JSON.stringify(mahjongData));
            updateOverallStats();
            renderCalendar();
            alert("å·²å„²å­˜ï¼");
        }

        function clearForm() {
            if(confirm("ç¢ºå®šæ¸…é™¤æ­¤æ—¥ç´€éŒ„ï¼Ÿ")) {
                delete mahjongData[selectedDate];
                localStorage.setItem('mahjong_2026_data', JSON.stringify(mahjongData));
                selectDate(selectedDate);
                updateOverallStats();
            }
        }

        function updateOverallStats() {
            const totals = {};
            Object.values(mahjongData).forEach(day => {
                day.players.forEach(p => {
                    if (!totals[p.name]) totals[p.name] = { win: 0, loss: 0, net: 0 };
                    totals[p.name].win += p.win;
                    totals[p.name].loss += p.loss;
                    totals[p.name].net += (p.win - p.loss);
                });
            });
            const sorted = Object.entries(totals).sort((a, b) => b[1].net - a[1].net);
            const list = document.getElementById('overallStatsList');
            if (sorted.length === 0) { list.innerHTML = '<p class="text-[10px] text-gray-400 text-center">å°šç„¡ç´€éŒ„</p>'; return; }
            list.innerHTML = sorted.map(([name, data], index) => `
                <div class="flex items-center justify-between p-1.5 bg-white rounded-lg border border-pink-50 shadow-sm text-[10px]">
                    <div class="truncate font-bold text-gray-600">${index+1}. ${name}</div>
                    <div class="font-bold ${data.net >= 0 ? 'text-green-500' : 'text-red-500'}">${data.net >= 0 ? '+' : ''}${data.net}</div>
                </div>
            `).join('');
        }

        window.onload = init;
    </script>
</body>
</html>
